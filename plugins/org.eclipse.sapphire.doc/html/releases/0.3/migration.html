<html>

<head>
  <title>Migration Guide for Sapphire 0.3</title>
  <link rel="StyleSheet" href="../../style.css" TYPE="text/css"/>
  <style type="text/css">
    pre.source-code 
    {
      font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; 
      color: #000000;
      background-color: #ffffff;
      font-size: 12px;
      border: 0px;
      line-height: 14px;
      padding: 5px;
      margin-left: 0px;
      margin-right: 0px;
      overflow: auto
    }
</style></head>

<body>

<h1>Migration Guide for 0.3</h1>

<p>This documents covers code changes that need to be made by Sapphire adopters as part of migrating 
to 0.3 release. Only changes from the previous milestone are covered.</p>

<p>Table of Contents</p>

<ol>
  <li><a href="#modularity">Modularity Changes</a></li>
  <li><a href="#ref">ReferenceValue Changes</a></li>
  <li><a href="#services">Services</a></li>
  <li><a href="#validation">Validation</a></li>
  <li><a href="#java">Java Support</a></li>
  <li><a href="#html">HTML Content Presentation</a></li>
  <li><a href="#related-content">Related Content</a></li>
  <li><a href="#composite-ref">Composite Reference</a></li>
  <li><a href="#section-description">Section Description</a></li>
</ol>

<h2><a name="modularity">Modularity Changes</a></h2>

<p>The contents of some bundles have changes and several new bundles have been created. These changes
may require adopters to modify Requite-Bundle declarations and import statements.</p>

<table>
  <tr>
    <th>Old Bundle</th>
    <th>Old Package</th>
    <th>New Bundle</th>
    <th>New Package</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.modeling</code></pre>
    </td>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.modeling.xml<br/>org.eclipse.sapphire.modeling.xml.annotations<br/>org.eclipse.sapphire.modeling.xml.schema</code></pre>
    </td>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.modeling.xml</code></pre>
    </td>
    <td>
<pre class="source-code"><code>unchanged</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.ui</code></pre>
    </td>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.ui.xml</code></pre>
    </td>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.ui.swt.xml.editor</code></pre>
    </td>
    <td>
<pre class="source-code"><code>org.eclipse.sapphire.ui.swt.xml.editor</code></pre>
    </td>
  </tr>
</table>

<h2><a name="ref">ReferenceValue Changes</a></h2>

<p>The ReferenceValue class now takes two type parameters instead of one. The first is the 
type of the reference. This used to be assumed to always be a string. The second is the type 
of what the reference resolves to.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>ReferenceValue&lt;ImageDescriptor> getImage();</code></pre>
    </td>
    <td>
<pre class="source-code"><code>ReferenceValue&lt;String,ImageDescriptor> getImage();</code></pre>
    </td>
  </tr>
</table>

<h2><a name="services">Services</a></h2>

<p>A few changes have been made to the services API.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>public class MyService extends ModelElementService
{
    public void init( final IModelElement element )
    {
        super.init( element );

        ...
    }
}</code></pre>
    </td>
    <td>
<pre class="source-code"><code>public class MyService extends ModelElementService
{
    public void init( final IModelElement element,
                      final String[] params )
    {
        super.init( element, params );

        ...
    }
}</code></pre>
    </td>
  </tr>
</table>

<h2><a name="validation">Validation</a></h2>

<p>Validators are now model element services. They can be registered globaly via the extension
system or at the level of an individual property using the @Service annotation.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>@Validator( service = MyValidator.class )</code></pre>
    </td>
    <td>
<pre class="source-code"><code>@Service( impl = MyValidationService.class )</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>@Validators
(
    @Validator( service = MyValidator1.class ),
    @Validator( service = MyValidator2.class )
)</code></pre>
    </td>
    <td>
<pre class="source-code"><code>@Services
(
    @Service( impl = MyValidationService1.class ),
    @Service( impl = MyValidationService2.class )
)</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>public class CustomValidator extends ModelPropertyValidator&lt;Value&lt;?>>
{
    public IStatus validate( Value&lt;?> value )
    {
        ...
    }

}</code></pre>
    </td>
    <td>
<pre class="source-code"><code>public class CustomValidationService extends ModelPropertyValidationService&lt;Value&lt;?>>
{
    public IStatus validate()
    {
        final Value&lt;?> value = target();

        ...
    }
}</code></pre>
    </td>
  </tr>
</table>

<h2><a name="java">Java Support</a></h2>

<p>Support for writing models that reference Java types has been improved.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>@JavaTypeConstraints( ... )</code></pre>
    </td>
    <td>
<pre class="source-code"><code>@JavaTypeConstraint( ... )</code></pre>
    </td>
  </tr>
</table>

<h2><a name="html">HTML Content Presentation</a></h2>

<p>Support for presenting HTML content in Sapphire UI was introduced in the 0.2 release in
the form of @HtmlContent annotation and a read-only property editor. This approach proved
to be too inflexible and has been replaced with a dedicated HTML UI part that can display
HTML content that's statically specified, drawn from the model or even fetched remotely.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>@HtmlContent</code></pre>
    </td>
    <td>
<pre class="source-code"><code><i>remove</i></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;property-editor>
  &lt;property>MessageBody&lt;/property>
  &lt;hint>
    &lt;name>show.label&lt;/name>
    &lt;value>false&lt;/value>
  &lt;/hint>
&lt;/property-editor></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;html>
  &lt;content>${ MessageBody }&lt;/content>
  &lt;show-border/>
&lt;/html></code></pre>
    </td>
  </tr>
</table>

<p><a href="index.html#html">See New Feature Documentation</a></p>

<h2><a name="related-content">Related Content</a></h2>

<p>The ability to augment a property editor with an auxiliary property editor has been generalized
into a more powerful related content feature.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;property-editor>
  &lt;property>MainProperty&lt;/property></font>
  &lt;aux-property-editor>RelatedProperty&lt;/aux-property-editor>
<font color="#888888">&lt;/property-editor></font></code></pre>
    </td>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;property-editor>
  &lt;property>MainProperty&lt;/property></font>
  &lt;related-content>
    &lt;property-editor>RelatedProperty&lt;/property-editor>
  &lt;/related-content>
<font color="#888888">&lt;/property-editor></font></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;property-editor>
  &lt;property>MainProperty&lt;/property></font>
  &lt;aux-property-editor>RelatedProperty1&lt;/aux-property-editor>
  &lt;aux-property-editor>RelatedProperty2&lt;/aux-property-editor>
<font color="#888888">&lt;/property-editor></font></code></pre>
    </td>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;property-editor>
  &lt;property>MainProperty&lt;/property></font>
  &lt;related-content>
    &lt;property-editor>
      &lt;property>RelatedProperty1&lt;/property>
      &lt;related-content>
        &lt;property>RelatedProperty2&lt;/property>
      &lt;/related-content>
    &lt;/property-editor>
  &lt;/related-content>
<font color="#888888">&lt;/property-editor></font></code></pre>
    </td>
  </tr>
</table>

<p><a href="index.html#related-content">See New Feature Documentation</a></p>

<h2><a name="composite-ref">Composite Reference</a></h2>

<p>The composite-ref construct has been replaced with a more flexible include construct which allows
any form part to be included.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;composite-ref>
  &lt;id>bug.report&lt;/id>
&lt;/composite-ref></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;include>bug.report&lt;/include></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;composite-ref>
  &lt;id>bug.report&lt;/id>
  &lt;param>
    &lt;name>SomeParam&lt;/name>
    &lt;value>SomeValue&lt;/value>
  &lt;/param>
&lt;/composite-ref></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;include>
  &lt;part>bug.report&lt;/part>
  &lt;param>
    &lt;name>SomeParam&lt;/name>
    &lt;value>SomeValue&lt;/value>
  &lt;/param>
&lt;/include></code></pre>
    </td>
  </tr>
</table>

<p>The following Eclipse search/replace regular expressions can be used to perform this
migration (only works when there are no params):</p>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.sdef<br/>
<nobr>Search: &nbsp;&nbsp;(?s)&lt;composite-ref>.*?&lt;id>(.*?)&lt;/id>.*?&lt;/composite-ref></nobr><br/>
<nobr>Replace: &nbsp;&lt;include>\1&lt;/include></nobr></p>

<h2><a name="section-description">Section Description</a></h2>

<p>The description construct under section has been removed. Use label and spacer to achieve the same result.</p>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;section>
  &lt;description>description&lt;/description></id>
&lt;/section></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;section>
  &lt;content>
    &lt;label>description&lt;/label>
    &lt;spacer/>
  &lt;/content>
&lt;/section></code></pre>
    </td>
  </tr>
</table>

<br/><br/>

</body>

</html>