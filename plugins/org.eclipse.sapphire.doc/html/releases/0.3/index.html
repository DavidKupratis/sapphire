<html>

<head>
  <title>Enhancements in Sapphire 0.3</title>
  <link rel="StyleSheet" href="../../style.css" TYPE="text/css"/>
</head>

<body>

<h1>Enhancements in 0.3</h1>

<ol>
  <li><a href="#common">Common</a></li>
  <ol type="A">
    <li><a href="#el">Expression Language Improvements</a></li>
  </ol>
  <li><a href="#modeling">Modeling</a></li>
  <ol type="A">
    <li><a href="#folding">Folding XML Element Binding</a></li>
  </ol>
  <li><a href="#ui">UI</a></li>
  <ol type="A">
    <li><a href="#html">HTML Content Presentation</a></li>
    <li><a href="#related-content">Related Content</a></li>
    <li><a href="#action-label-el">Expressions in Action Labels</a></li>
  </ol>
</ol>
 
<h2><a name="common"><a name="el">Expression Language Improvements</a></a></h2>

<p>Index into any list using array notation.</p>

<p style="margin-left: 20px;"><b>Example</b><p>

<pre class="source-code"><code>${ Contacts[ 0 ].Name }</code></pre>

<p>Retrieve the size of any collection using Size property.</p>

<p style="margin-left: 20px;"><b>Example</b><p>

<pre class="source-code"><code>${ Contacts.Size }</code></pre>

<p>Take advantage of actual conditional evaluation of the conditional operator. In the 0.2 release,
the conditional operator would always evaluate both alternatives, which made it impossible to use
it in cases where evaluating the unused alternative results in an error.</p>

<p style="margin-left: 20px;"><b>Example</b><p>

<p style="margin-left: 20px;">In this example, evaluating the true alternative when the size of the contacts list is zero would
produce an error.</p>

<pre class="source-code"><code>${ Contacts.Size == 1 ? Contacts[ 0 ].Name : "multiple contacts" }</code></pre>

<p>The expression language in the 0.2 release supported navigating down the model hierarchy
using Foo.Bar.Xyz syntax, but in certain cases it is useful to navigate up the model hierarchy. To
support these scenarios, Parent and Root functions have been added.</p>

<p style="margin-left: 20px;"><b>Examples</b><p>

<pre class="source-code"><code>${ Parent().Name == "John" }
${ Parent().Parent().Name == "John" }
${ Root().Name == "John" }
</code></pre>

<h2><a name="modeling"><a name="folding">Folding XML Element Binding</a></a></h2>

<p>In certain cases, while a given XML element can have a number of child
elements, one of the child elements occurs by itself with high frequency. In
these cases, it useful to reduce the verbosity of XML by folding the child
element into the parent.</p>

<p>Using the folding binding, it is possible to have the same value property
bind to "xyz" string in both of the following examples. If a child element
is added, first form will automatically transform into the second. Similarly,
if all child element except the folding one are removed, the second form
will automatically transform into the first.</p>

<pre class="source-code"><code>&lt;root>xyz&lt;/root></code></pre>

<pre class="source-code"><code>&lt;root>
  &lt;a>xyz&lt;/a>
  ...
&lt;/root></code></pre>

<p>To use this feature, specify XML binding as follows:</p>

<pre class="source-code"><code>@CustomXmlValueBinding( impl = FoldingXmlValueBindingImpl.class, params = "a" )</code></pre>

<p>Set params attribute to the name of the folding element. Take care not to
apply this binding to more than one child element in a given parent.</p>

<h2><a name="html">HTML Content Presentation</a></h2>

<p>It is hard to beat the simplicity and flexibility of HTML for presenting formatted
text content. Now it is even easier to weave in a bit of HTML into a Sapphire UI. The new
HTML part can display static HTML content embedded in an sdef file, content retrieved
from a URL or content retrieved from the model.</p>

<p>Frequently, it is easier to specify HTML content in the form of a fragment rather than a
finished document. Sapphire will automatically turn a fragment into a legal document and apply
default style that is designed to match the look of surrounding UI elements.</p>

<pre class="source-code"><code>&lt;html>
  &lt;fragment>true&lt;/fragment>
  &lt;content>
    Here is the list of ${ Name }'s favorite colors:&amp;lt;br/>&amp;lt;br/>
    &amp;lt;ol>
      &amp;lt;li>Red&amp;lt;/li>
      &amp;lt;li>Orange&amp;lt;/li>
      &amp;lt;li>Blue&amp;lt;/li>
    &amp;lt;/ol>
  &lt;/content>
&lt;/html></code></pre>

<p>Note how HTML tags have to be escaped in order to not be treated as part of the XML
markup of the sdef file. Also note that you are able to use expressions in the body of the
content to enhance the content with data from the model or external sources.</p>

<h2><a name="related-content">Related Content</a></h2>

<p>It is now possible to put related content to the right of a property
editor.</p> 

<p>The space for related content is carved out from the space reserved for
the main property editor. As such, it is bound by the height of that property editor, but
multiple parts can be added to related content as long as vertical space allows. This
can happen if the main property editor is a table or a multi-line text box.</p>

<p>Horizontal space between the main property editor and related content is divided by 
an adjustable splitter. You get to set the initial width allocation for the related 
content in the sdef file. The default is 40, which stands for 40% of available space.</p>  

<p>Use related content to display two property editors on one line. This pattern is especially
powerful when the relationship of two properties is such that a single label will suffice.</p>

<p style="margin-left: 20px;"><img src="images/related-content-1.png"/></p>

<p>Display more than two parts on one line by nesting related content inside related content. 
Use sparingly.</p>

<p style="margin-left: 20px;"><img src="images/related-content-2.png"/></p>

<p>Related content isn't limited to property editors. Any part can be placed into related
content. This is particularly useful when the main property editor spans more than one
vertical line, such as a list property editor or a multi-line text box. In this example,
related content is used to display explanatory text.</p>

<p style="margin-left: 20px;"><img src="images/related-content-3.png"/></p>

<p>Multiple parts can be placed into related content. They will be arranged vertically.</p>

<p style="margin-left: 20px;"><img src="images/related-content-4.png"/></p>

<h2><a name="action-label-el">Expressions in Action Labels</a></h2>

<p>Labels for actions and action handlers can now be specified using expressions. This is currently
mostly useful for action labels, where you can reference active handlers while composing the label.</p>

<p style="margin-left: 20px;"><b>Example</b><p>

<p style="margin-left: 20px;">This following is the actual label definition for the Sapphire.Add action. It is designed to include
handler label in the action label when there is only one handler.</p>

<pre class="source-code"><code>${ Handlers.Size == 1 ? Concat( "add ", Handlers[ 0 ].Label ) : "add" }</code></pre>

<br/><br/>

</body>

</html>