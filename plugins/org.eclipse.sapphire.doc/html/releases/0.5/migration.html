<!-- 
 ******************************************************************************
 * Copyright (c) 2012 Oracle
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Konstantin Komissarchik - initial implementation and ongoing maintenance
 ******************************************************************************
-->

<html>

<head>
  <title>Migration Guide for Sapphire 0.5</title>
  <link rel="StyleSheet" href="../../style.css" TYPE="text/css"/>
  <style type="text/css">
    pre.source-code 
    {
      font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; 
      color: #000000;
      background-color: #ffffff;
      font-size: 12px;
      border: 0px;
      line-height: 14px;
      padding: 5px;
      margin-left: 0px;
      margin-right: 0px;
      overflow: auto
    }
</style></head>

<body>

<h1>Migration Guide for 0.5</h1>

<p>This documents covers code changes that need to be made by Sapphire adopters as part of migrating 
to 0.5 release. Only changes from the previous release are covered.</p>

<p>Table of Contents</p>

<ol>
  <li><a href="#Actuator">Actuator</a></li>
  <li><a href="#ContentOutlineNodeImage">Content Outline Node Image</a></li>
  <li><a href="#GraphitiToGef">Graphiti to GEF Transition</a></li>
  <ol type="A">
    <li><a href="#SapphireDiagramEditor">SapphireDiagramEditor</a></li>
    <li><a href="#DiagramImage">Diagram Image</a></li>
  </ol>
  <li><a href="#Miscellaneous">Miscellaneous</a></li>
</ol>


<h2><a name="Actuator">Actuator</a></h2>

<p>The action link facility in sdef language has been generalized to support other presentations. In the
process it was renamed as actuator.</p> 

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;action-link>
    <font color="#888888">&lt;action-id>Sapphire.Add&lt;/action-id>
    &lt;label>add a contact&lt;/label></font>
&lt;/action-link>
</code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;actuator>
    <font color="#888888">&lt;action-id>Sapphire.Add&lt;/action-id>
    &lt;label>add a contact&lt;/label></font>
&lt;/actuator>
</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;action-link>
    <font color="#888888">&lt;action-id>Sapphire.Add&lt;/action-id>
    &lt;label>add a contact&lt;/label></font>
    &lt;show-image/>
&lt;/action-link>
</code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;actuator>
    <font color="#888888">&lt;action-id>Sapphire.Add&lt;/action-id>
    &lt;label>add a contact&lt;/label></font>
    &lt;show-image>true&lt;/show-image>
&lt;/actuator>
</code></pre>
    </td>
  </tr>
</table>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.sdef<br/>
<nobr>Search: &nbsp;&nbsp;(?s)&lt;action-link>(.*?)&lt;show-image/>(.*?)&lt;/action-link></nobr><br/>
<nobr>Replace: &nbsp;&lt;actuator>\1&lt;show-image>true&lt;/show-image>\2&lt;/actuator></nobr></p>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.sdef<br/>
<nobr>Search: &nbsp;&nbsp;(?s)&lt;action-link>(.*?)&lt;/action-link></nobr><br/>
<nobr>Replace: &nbsp;&lt;actuator>\1&lt;/actuator></nobr></p>



<h2><a name="ContentOutlineNodeImage">Content Outline Node Image</a></h2>

<p>Prior to advent of Sapphire Expression Language, sdef language included the "use-model-element-image" switch
as a way to indicate to the system that content outline node's image should be the same as the image for the
associated model element. With advent of EL, the special switch is no longer necessary as an expression can be used
to capture the same semantics.</p> 

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;use-model-element-image/></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;image>${ Image() }&lt;/image></code></pre>    
    </td>
  </tr>
</table>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.sdef<br/>
<nobr>Search: &nbsp;&nbsp;&lt;use-model-element-image[ ]*/></nobr><br/>
<nobr>Replace: &nbsp;&lt;image>\${ Image() }&lt;/image></nobr></p>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.sdef<br/>
<nobr>Search: &nbsp;&nbsp;&lt;use-model-element-image>[ ]*&lt;/use-model-element-image></nobr><br/>
<nobr>Replace: &nbsp;&lt;image>\${ Image() }&lt;/image></nobr></p>



<h2><a name="GraphitiToGef">Graphiti to GEF Transition</a></h2>

<p>In this release the dependency on Graphiti has been removed and the Sapphire Diagram UI has been rebased on straight GEF. The changes that will be required to existing diagram editors in previous 0.4 release are detailed below.</p> 

<h2><a name="SapphireDiagramEditor">SapphireDiagramEditor</a></h2>

<p>The use of SapphireDiagramEditor in 0.5 requires the following changes for adopters in previous 0.4.x release.  
<ol>
  <li>Package namespace changed from org.eclipse.sapphire.ui.gef.diagram.editor to org.eclipse.sapphire.ui.swt.gef</li>
  <li>Constructor for SapphireDiagramEditor now requires passing in the parent SapphireEditor.</li>
  <li>No longer need to create DiagramEditorInput</li>
</ol>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td> 
<pre class="source-code"><code>import org.eclipse.sapphire.ui.gef.diagram.editor.SapphireDiagramEditor;
</code></pre>
    </td>
    <td>
   <pre class="source-code"><code>import org.eclipse.sapphire.ui.swt.gef.SapphireDiagramEditor;
</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>this.pageDiagram = new SapphireDiagramEditor( this.model, path );</code></pre>
    </td>
    <td>
<pre class="source-code"><code>this.pageDiagram = new SapphireDiagramEditor( sapphireEditor, this.architectureModel, path );</code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>pageDiagram = new SapphireDiagramEditor( model, path );
SapphireDiagramEditorInput diagramEditorInput = 
	SapphireDiagramEditorFactory.createEditorInput( file );
addPage( 0, pageDiagram, diagramEditorInput );</code></pre>
    </td>
    <td>
<pre class="source-code"><code>pageDiagram = new SapphireDiagramEditor( sapphireEditor, model, path );
addPage( 0, pageDiagram, getEditorInput() );</code></pre>
    </td>
  </tr>
</table>

<h2><a name="DiagramImage">Diagram Image</a></h2>

<p>Image specifications inside diagram parts are now consistent with the rest of the sdef. 
Images are now referenced at the point of use, rather than defined separately and then referenced by id.</p> 

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;image-decorator>
    &lt;id>defaultIndicator&lt;/id>
    &lt;path>icons/default-indicator.png&lt;/path>
&lt;/image-decorator></code></pre>
    </td>
    <td>
    Remove, path will be specified at the point of use.
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;image-decorator></font>
    &lt;id>defaultIndicator&lt;/id>
    <font color="#888888">&lt;decorator-placement>image&lt;/decorator-placement>
    &lt;horizontal-align>center&lt;/horizontal-align>
    &lt;vertical-align>top&lt;/vertical-align>
&lt;/image-decorator></font></code></pre>
    </td>
    <td>
<pre class="source-code"><code><font color="#888888">&lt;image-decorator></font>
    &lt;path>icons/default-indicator.png&lt;/path>
    <font color="#888888">&lt;decorator-placement>image&lt;/decorator-placement>
    &lt;horizontal-align>center&lt;/horizontal-align>
    &lt;vertical-align>top&lt;/vertical-align>
&lt;/image-decorator></font></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;tool-palette-image>
    &lt;id>flowPaletteImage&lt;/id>
    &lt;path>icons/control-flow-16.png&lt;/path>
&lt;/tool-palette-image></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;tool-palette-image>icons/control-flow-16.png&lt;/tool-palette-image></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code>&lt;image>
    &lt;id>routerIcon&lt;/id>
    &lt;placement>top&lt;/placement>
    &lt;possible>
      &lt;id>routerIcon&lt;/id>
      &lt;path>icons/node-router.png&lt;/path>
    &lt;/possible>        
&lt;/image></code></pre>
    </td>
    <td>
<pre class="source-code"><code>&lt;image>
    &lt;path>icons/node-router.png&lt;/path>
    &lt;placement>top&lt;/placement>
&lt;/image></code></pre>
    </td>
  </tr>
</table>


<h2><a name="Miscellaneous">Miscellaneous</a></h2>

<table>
  <tr>
    <th>Before</th>
    <th>After</th>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code><font color="#888888">import org.eclipse.sapphire.ui.def.</font>ISapphireActionHandlerDef<font color="#888888">;</font></code></pre>
    </td>
    <td>
<pre class="source-code"><code><font color="#888888">import org.eclipse.sapphire.ui.def.</font>ActionHandlerDef<font color="#888888">;</font></code></pre>
    </td>
  </tr>
  <tr>
    <td>
<pre class="source-code"><code><font color="#888888">public class CustomActionHandler extends SapphireActionHandler
{
    @Override
    public void init( SapphireAction action,</font> ISapphireActionHandlerDef <font color="#888888">def )
    {
        super.init( action, def );
        
        ...
    }
    
    ...
}</font></code></pre>
    </td>
    <td>
<pre class="source-code"><code><font color="#888888">public class CustomActionHandler extends SapphireActionHandler
{
    @Override
    public void init( SapphireAction action,</font> ActionHandlerDef <font color="#888888">def )
    {
        super.init( action, def );
        
        ...
    }
    
    ...
}</font></code></pre>
    </td>
  </tr>
</table>

<p style="margin-left: 20px;"><code>Scope: &nbsp;&nbsp;&nbsp;*.java<br/>
<nobr>Search: &nbsp;&nbsp;ISapphireActionHandlerDef</nobr><br/>
<nobr>Replace: &nbsp;ActionHandlerDef</nobr></p>


<div class="copyright">Copyright (c) 2012 Oracle<br/>
Content made available under the terms of <a href="http://www.eclipse.org/legal/epl-v10.html">Eclipse Public License</a>.</div>

</body>

</html>