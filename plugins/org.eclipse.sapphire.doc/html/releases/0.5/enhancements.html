<!-- 
 ******************************************************************************
 * Copyright (c) 2012 Oracle and Liferay
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *    Konstantin Komissarchik - initial implementation and ongoing maintenance
 *    Gregory Amerson - [372359] Provide means to extend the behavior of adapt methods
 ******************************************************************************
-->

<html>

<head>
  <title>Enhancements in Sapphire 0.5</title>
  <link rel="StyleSheet" href="../../style.css" TYPE="text/css"/>
</head>

<body>
<h1>Enhancements in 0.5</h1>
<ol>
  <li><a href="#UI">User Interface</a></li>
  <ol type="A">
    <li><a href="#MoreFlexibleActuatorPresentation">More Flexible Actuator Presentation</a></li>
  </ol>
  <li><a href="#DiagramLayout">Diagram Layout Storage</li>
  <li><a href="#DiagramContextHelp">Diagram Context Help</li>
  <li><a href="#Services">Services</a></li>
  <ol type="A">
    <li><a href="#PartServices">Part Services</a></li>
    <li><a href="#AdapterService">AdapterService</a></li>
  </ol>
</ol>


<h2><a name="UI"><a name="MoreFlexibleActuatorPresentation">More Flexible Actuator Presentation</a></a></h2>

<p>An actuator provides means to invoke an action. The action could be drawn from the context where actuator 
is placed or provided as part of actuator's definition. Actuators were formerly limited to links and were
referred to as action links. New for this release is the ability to choose either link or button presentation
along with ability to control horizontal alignment.</p>

<p style="margin-left: 20px;"><b>Example</b></p>

<pre class="source-code"><code><font color="#888888">&lt;actuator>
    &lt;action-id>Sapphire.Gallery.Actuators.DoubleTheNumber&lt;/action-id>
    &lt;action>
        &lt;id>Sapphire.Gallery.Actuators.DoubleTheNumber&lt;/id>
        &lt;label>double the number&lt;/label>
    &lt;/action>
    &lt;action-handler>
        &lt;id>Sapphire.Gallery.Actuators.DoubleTheNumber&lt;/id>
        &lt;action>Sapphire.Gallery.Actuators.DoubleTheNumber&lt;/action>
        &lt;impl>ActuatorsGalleryDoubleTheNumberActionHandler&lt;/impl>
    &lt;/action-handler></font>
    &lt;span>false&lt;/span>
    &lt;horizontal-align>right&lt;/horizontal-align>
    &lt;style>Sapphire.Actuator.Button&lt;/style>
<font color="#888888">&lt;/actuator></font></code></pre>

<p style="margin-left: 20px;"><img src="images/MoreFlexibleActuatorPresentation.png"/></p>

<h2><a name="DiagramLayout">More Flexible Diagram Layout Storage</a></h2>

<p>Diagram Editor can now open workspace files, non-workspace files and non-local files. Developer can
choose to store diagram's layout information in a separate file in the same folder as the file being
edited, or a computed unique folder in project's .setting directory or in current workspace's .metadata directory.
Third party developers can also provide a customized layout storage service. The service should extend
<font color="#888888">DiagramLayoutPersistenceService</font> class. The architecture sample has been
modified to provide an "in place" layout storage which stores the diagram layout info in  
architecture.xml file. Developers can use that as an example if they want to implement their own
layout storage service.</p>

<p>The diagram layout storage mechanism is controlled by diagram page definition's "LayoutStorage" property.</p>

<h2><a name="DiagramContextHelp">Diagram Context Help</a></h2>

<p>Diagram Editor now supports context sensitive help. When a node or connection is selected, hitting "F1"
will display the context help associated with the node/connection model element through the @Documentation 
annotation. If nothing is selected in the diagram editor, hitting "F1" will display the context help associated
with the root model element for the diagram editor.</p>

<h2><a name="Services"><a name="PartServices">Part Services</a></a></h2>

<p>Services can now be attached to parts. This enhancement allows extensibility for parts to be handled with
the same API that adopters should already be familiar with from the model layer.</p>

<p>To attach a part service via the extension system, use Sapphire.Part context.</p>

<p style="margin-left: 20px;"><b>Example</b></p>

<pre class="source-code"><code><font color="#888888">&lt;extension></font>
    &lt;service>
        &lt;id>Example.CustomLayoutPersistenceService&lt;/id>
        &lt;context>Sapphire.Part&lt;/context>
        &lt;type>org.eclipse.sapphire.ui.diagram.layout.DiagramLayoutPersistenceService&lt;/type>
        &lt;factory>org.example.CustomLayoutPersistenceService$Factory&lt;/factory>
    &lt;/service>
<code><font color="#888888">&lt;/extension></font></code></pre>

<p>Services can also be attached to parts at the local level in sdef.</p>

<p style="margin-left: 20px;"><b>Example</b></p>

<pre class="source-code"><code><font color="#888888">&lt;definition>
    &lt;diagram-page></font>
        &lt;service>            
            &lt;implementation>CustomLayoutPersistenceService&lt;/implementation>
        &lt;/service>
    <font color="#888888">&lt;/diagram-page>
&lt;/definition></font></code></pre>


<h2><a name="AdapterService">AdapterService</a></h2>

<p>The AdapterService provides means to extend the behavior of the adapt method in a given context.</p>

<p>For example, out of the box, Sapphire can adapt IModelElement to IProject assuming that the model is using
an IFile for the underlying resource store.  However, in some cases there may be no underlying IFile, so the
default logic will no be able to find IProject. To solve this problem, we can introduce an adapter service to 
provide a custom method for adopting IModelElement to IProject.</p>

<p style="margin-left: 20px;"><b>Example</b></p>

<pre class="source-code"><code><font color="#888888">@GenerateImpl</font>
@Service( impl = NewProjectFileOpAdapter.class )

<font color="#888888">public interface INewProjectFileOp extends IModelElement
{
    ...
}</font></code></pre>

<pre class="source-code"><code>public class NewProjectFileOpAdapter extends AdapterService
{
    @Override
    public &lt;A&gt; A adapt( Class&lt;A&gt; adapterType )
    {
        if( IProject.class == adapterType )
        {
            INewProjectFileOp op = context( INewProjectFileOp.class );
            IProject project = op.getProject().resolve();

            if( project != null )
            {
                return adapterType.cast( project );
            }
        }

        return null;
    }
}</code></pre>


<div class="copyright">Copyright (c) 2012 Oracle and Liferay<br/>
Content made available under the terms of <a href="http://www.eclipse.org/legal/epl-v10.html">Eclipse Public License</a>.</div>


</body>

</html>